<html>
    <head>
        <link rel="stylesheet" href="index.css">
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    </head>
    <body>

        <!-- <div class="popup">
            <div class="popup-content">PARTY DI CAPODANNO 2022</div>
            <a class="nostyle" href="./images/capodanno21-full.png" target="_blank">
                <div class="popup-button">SCOPRI DI PIÚ</div>
            </a>
        </div> -->


        <div class="home">
            <div class="home-content">
            
                <!-- <div class="title">BENVENUTO</div> -->

                <div style="background-image: url(./images/jb_logo.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 100%; height: auto; flex-grow: 6;"></div>

                <div class="title-big">BENVENUTO!</div>
                
                <div class="title" style="cursor: pointer;" onclick="closeHome()">VAI AL MENU</div>

                <br/>

                <!-- <a class="nostyle title" style="cursor: pointer;" href="./files/MENU-2021-REV5.pdf" download="menu-jb.pdf">SCARICA PDF</a> -->

                <div class="text"><div>Prima di ordinare, verifica attentamente l'elenco degli allergeni e degli ingredienti in ciascuna pietanza:</div></div>
                <div class="text" style="display: flex; flex-wrap:wrap; gap: 3vmin;">
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_celery.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Sedano</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_crustaceans.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Crostacei</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_eggs.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Uova</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_fish.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Pesce</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_gluten.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Glutine</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_lupin.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Lupino</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_milk.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Lattosio</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_molluscs.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Molluschi</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_mustard.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Senape</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_peanuts.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Arachidi</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_sesame.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Sesamo</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_soya.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Soia</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_sulphites.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Solfiti</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_tree_nuts.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Frutta a guscio</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_spicyhot.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Piccante</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 1vmax; align-items: center; align-content: center; justify-content: center; justify-items: center;">
                        <div style="background-image: url(./images/allergens_vegan.png); background-repeat: no-repeat; background-position: center; background-size: contain; width: 3vh; height: 3vh;"></div>
                        <div class="text-small">Vegan</div>
                    </div>

                    <!-- <div>Glutine</div>
                    <div>Arachidi</div>
                    <div>Sedano</div>
                    <div>Senape</div>
                    <div>Pesce</div>
                    <div>Soia</div>
                    <div>Solfiti</div>
                    <div>Uova</div>
                    <div>Latte</div>
                    <div>Frutta a guscio</div>
                    <div>Molluschi</div>
                    <div>Crostacei</div>
                    <div>Sesamo</div>
                    <div>Lupino</div>
                    <div>Piccante</div>
                    <div>Vegan</div> -->
                </div>
                <div class="text">Restiamo a disposizione per ulteriori informazioni.</div>
                <div class="text-small" style="flex-direction: column;">
                    <div>Le preparazioni contrassegnate da "*" e "**" indicano</div>
                    <div>* prodotto congelato all'origine</div>
                    <div>** prodotto congelato in loco con abbattimento rapido</div>
                </div>
            </div>
        </div>

        <div id="page" style="position:fixed; left: 0; top: 0; visibility: hidden;">
            <div class="logo"></div>
            <div v-if="currentCategory">
                <div class="category-box box">
                    <!-- <div class="category-image"></div> -->
                    <div class="category-title" v-on:click="currentCategory.selected = false; currentCategory = null;">
                        <!-- <div style="display: grid; grid-template-rows: 1fr 1fr;"> -->
                        <div v-bind:class="{ 'subcategory-header': currentSubcategory }">
                            <div>{{currentCategory.name}}</div>
                            <div style="display: grid; grid-template-columns: 10vw 1fr; align-content: center;" v-if="currentSubcategory">
                                <div v-on:click.stop="currentSubcategory.expanded = false" style="margin-right: 1vw;" class="category-button close"></div>
                                <div>{{currentSubcategory.name}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="category-button minus" v-on:click="currentCategory.selected = false; currentCategory = null;"></div>
                    <!-- <div class="category-subtitle">SOTTOTITOLO</div> -->
                </div>
                <div class="items-container">
                    <div v-for="subcategory in currentCategory.subcategories" v-if="!subcategory.hidden" class="observable" v-bind:data-category-id="currentCategory.id" v-bind:data-subcategory-id="subcategory.id">
                        <div class="subcategory-box box" v-on:click="subcategory.expanded  ? subcategory.expanded = false : subcategory.expanded = true">
                            <div class="subcategory-title observable" data-subcategory-header="true" v-bind:data-category-id="currentCategory.id" v-bind:data-subcategory-id="subcategory.id">{{subcategory.name}}</div>
                            <div class="category-button" v-bind:class="{'minus':subcategory.expanded, 'plus':!subcategory.expanded}"></div>
                        </div>
                        <div v-if="subcategory.expanded">
                            <div class="item-box box" v-for="item in subcategory.items" v-if="!item.hidden">
                                <!-- <div class="item-column"> -->

                                    <div style="display: flex; flex-direction: column; padding-right: 6vw;">
                                    
                                        <div class="item-title-bar">
                                            <div class="item-title">{{item.name}}</div>
                                            <img :content="infoTooltip(info)" v-tippy="{ trigger : 'mouseenter', size: 'large', arrow: 'true' }" class="info-icon" v-for="info in item.infos" v-bind:src="'images/allergens_' + info + '.png'">
                                        </div>

                                        <div class="item-description" style="text-align:justify; text-justify: newspaper;">{{item.description}}</div>

                                        <div class="allergens-row">
                                            <div v-if="item.allergens.length">Contiene:</div>
                                            <img :content="infoTooltip(allergen)" v-tippy="{ trigger : 'mouseenter', size: 'large', arrow: 'true' }" class="info-icon" v-for="allergen in item.allergens" v-bind:src="'images/allergens_' + allergen + '.png'">
                                        </div>
                                    
                                    </div>

                                    <div class="prices-grid" >
                                        <div v-for="size in item.sizes" style="display: grid; grid-template-columns: 1fr 1fr; flex-grow: 1; align-items: center; justify-items: center; align-content: center; justify-content: center;">
                                            <div style="flex-grow: 1;" class="item-price">{{size.label}}</div>
                                            <div style="flex-grow: 1;" class="item-price">{{size.price}} €</div>
                                        </div>
                                        <!-- <template v-for="size in item.sizes"> -->
                                            <!-- <div class="item-description" style="white-space: nowrap;">{{size.label}}</div>
                                            <div class="item-description" style="white-space: nowrap;">{{size.price}}</div> -->
                                            <!-- <div class="item-price">{{size.label}}</div>
                                            <div class="item-price">{{size.price}}</div> -->
                                        <!-- </template> -->
                                    </div>

                                    <!-- <div class="item-description" style="margin-top: 1vh;">{{item.description}}</div>
                                    <div class="item-description" style="display: flex; align-items: center; margin-top: 2vh;">
                                        <span style="margin-right: 1vh;">Contiene:</span>
                                        <img :content="infoTooltip(allergen)" v-tippy="{ trigger : 'mouseenter', size: 'large', arrow: 'true' }" class="info-icon" v-for="allergen in item.allergens" v-bind:src="'images/allergens_' + allergen + '.png'">
                                    </div> -->

                                <!-- </div> -->
                                <!-- <div class="prices-grid"> -->
                                    <!-- <template v-for="size in item.sizes"> -->                         
                                    <!-- </template> -->
                                <!-- </div>     -->
                            </div>
                        </div>
                    </div>
    
                </div>
            </div>
            <div class="categories-column" v-if="!currentCategory">
                <!-- <div v-for="category in categories" v-bind:category="category" v-bind:style="{ 'background-image': 'url(\'./images/JB.macro.headers_' + category.id + '_ita.jpg\')'}"> -->
                <div v-for="category in categories">
                    <!-- <div class="category-box box" v-on:click="category.selected = !category.selected; currentCategory = category.selected ? category : null;"> -->
                        <div class="category-box box" v-on:click="category.selected = true; currentCategory = category;">
                        <!-- <div class="category-image"></div> -->
                        <div class="category-title"><span>{{category.name}}</span></div>
                        <div class="category-button plus"></div>
                        <!-- <div class="category-subtitle">SOTTOTITOLO</div> -->
                    </div>
                </div>
            </div>
            <div></div>
        </div>
    </body>

    
</html>

<script src="https://unpkg.com/vue-tippy/dist/vue-tippy.min.js"></script>

<script type="text/javascript">

var page = new Vue({
    el: '#page',
    data: {
        observer: null,
        currentCategory: null,
        categories: [],
        infos: {
            "celery": { "name": "Sedano" },
            "crustaceans": { "name": "Crostacei" },
            "eggs": { "name": "Uova" },
            "fish": { "name": "Pesce" },
            "gluten": { "name": "Glutine" },
            "herbs": { "name": "Speziato" },
            "lupin": { "name": "Lupino" },
            "milk": { "name": "Lattosio" },
            "molluscs": { "name": "Molluschi" },
            "mustard": { "name": "Senape" },
            "peanuts": { "name": "Arachidi" },
            "sesame": { "name": "Sesamo" },
            "soya": { "name": "Soia" },
            "spicyhot": { "name": "Piccante" },
            "sulphites": { "name": "Solfiti" },
            "tree_nuts": { "name": "Frutta a guscio" },
            "vegan": { "name": "Vegan" },
        },
        // stopSubcats: [
        //     "variations",
        //     "aperitivo",
        //     "menu_tema"
        // ],
        // stopItems: [
        //     "floreffe",
        //     "beamish",
        //     "slalom",
        //     "pecos",
        //     "hp weizen",
        //     "pandora",
        //     "limited edition",
        //     "capodanno"
        // ]
    },
    computed: {
        currentSubcategory() {
            let visibleSubcategories = []
            this.categories.forEach((category) => {
                category.subcategories.forEach((subcategory) => {
                    if (subcategory.visible) visibleSubcategories.push(subcategory)
                })
            })


            let anyHeaderVisible = false
            this.categories.forEach((category) => {
                category.subcategories.forEach((subcategory) => {
                    if (subcategory.headerVisible) anyHeaderVisible = true
                })
            })

            // console.log(visibleSubcategories)
            if (visibleSubcategories.length != 1 || anyHeaderVisible) return null
            else return visibleSubcategories[0]
        }
    },
    methods: {
        // showTooltip(event) {
        //     let element = event.target
        //     // let content = element.title
        //     tippy(element, {
        //         trigger: "manual",
        //         onShow: function(instance) {
        //             setTimeout(() => {
        //                 instance.destroy()
        //             }, 800);
        //         }
        //     }).show()
        // },
        infoTooltip(info) {
            return this.infos[info].name
        },
        onElementObserved(entries) {
            entries.forEach((entry) => {
                let subcategory = this.lookup(entry.target.dataset.categoryId, entry.target.dataset.subcategoryId)
                let subcategoryHeader = entry.target.dataset.subcategoryHeader ? true : false

                // console.log(entry)

                if (subcategoryHeader) {
                    subcategory.headerVisible = entry.isIntersecting
                }
                else {
                    subcategory.visible = entry.isIntersecting
                }

                // console.log("subcat " + subcategory.name + " vis " + subcategory.visible + " head " + subcategory.headerVisible)

                // console.log(subcategoryHeader)
                // console.log(this.currentSubcategory)
                // console.log(entry.isIntersecting)

                
            })
        },
        lookup(categoryId, subcategoryId) {
            let category = this.categories.filter((category) => category.id == categoryId)[0]
            let subcategory = null
            if (subcategoryId !== undefined ) {
                subcategory = category.subcategories.filter((subcategory) => subcategory.id == subcategoryId)[0]
                return subcategory
            }
            else return category
        }
    },
    created: function () {

        let options = {
            root: this.$el,
            rootMargin: '0px',
            // threshold: 1.0
            threshold: 0
        }
        this.observer = new IntersectionObserver(this.onElementObserved, options);

        fetch("./context.json")
            .then((resp) => resp.json())
            .then((json) => {

                json.categories.forEach(category => {
                    category.selected = false

                    category.subcategories.forEach(subcategory => {
                        subcategory.expanded = false
                        subcategory.visible = null
                        subcategory.headerVisible = null
                    });
                })

                this.categories = json.categories
            })
    },
    destroyed () {
        // console.log("destroyed")
    },
    beforeUpdate() {
        // console.log("beforeUpdate")

        // TODO Removed since currently is bugged (behavior stops working after section is changed)
        // document.querySelectorAll(".observable").forEach((element) => this.observer.unobserve(element));
    },
    updated() {
        // console.log("updated")
        document.querySelectorAll(".observable").forEach((element) => this.observer.observe(element));
    }
})

window.oncontextmenu = function(event) {
        event.preventDefault();
        event.stopPropagation();
        return false;
};

window.onbeforeunload = function() { return "Your work will be lost."; };

window.addEventListener('popstate', function (event)
{
    document.getElementsByClassName("home").item(0).style.visibility='visible'
    document.getElementById("page").style.visibility='hidden'

    document.getElementsByClassName("popup").item(0).style.display='block'
});

function closeHome() {
    document.getElementsByClassName("home").item(0).style.visibility='hidden'
    document.getElementById("page").style.visibility='visible'
    history.pushState(null, document.title, location.href);

    document.getElementsByClassName("popup").item(0).style.display='none'
}

</script>